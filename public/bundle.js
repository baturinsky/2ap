var app=function(t){"use strict";function e(t,e){let i=function(t,e){let i=Number.MAX_VALUE,n=-1;for(let s=0;s<t.length;s++){let r=e(t[s]);i>r&&(i=r,n=s)}if(n>=0)return{ind:n,item:t[n],val:i}}(t,t=>-e(t));if(i)return i.val=-i.val,i}function i(t,e){const i=document.createElement("canvas");return i.width=t,i.height=e,i}function n(t,e){const n=i(...t),s=n.getContext("2d");return s.lineWidth=1,s.strokeStyle="#000",e(s),n}function s(t,e){return Math.floor(t/e)}function r(t,e,i,n){return new(i||(i=Promise))(function(s,r){function a(t){try{l(n.next(t))}catch(t){r(t)}}function o(t){try{l(n.throw(t))}catch(t){r(t)}}function l(t){t.done?s(t.value):new i(function(e){e(t.value)}).then(a,o)}l((n=n.apply(t,e||[])).next())})}function a(t,e,i=1){return[t[0]+e[0]*i,t[1]+e[1]*i]}function o(t,e){return[t[0]-e[0],t[1]-e[1]]}function l(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function h(t,e){return l([t[0]-e[0],t[1]-e[1]])}function c(t,e,i){return[t[0]*(1-i)+i*e[0],t[1]*(1-i)+i*e[1]]}function d(t,e,i,n){var s=function(r,a,o,l){if(!(a>=o)){for(var h=Math.round((r-.5)*a),c=Math.ceil((r+.5)*o-.5),d=h;d<=c;d++){var u=t+l.xx*d+l.xy*r,f=e+l.yx*d+l.yy*r;if(i(u,f))d>=r*a&&d<=r*o&&n(u,f);else if(d>=(r-.5)*a&&d-.5<=r*o&&n(u,f),s(r+1,a,(d-.5)/r,l),(a=(d+.5)/r)>=o)return}s(r+1,a,o,l)}},r=[{xx:1,xy:0,yx:0,yy:1},{xx:1,xy:0,yx:0,yy:-1},{xx:-1,xy:0,yx:0,yy:1},{xx:-1,xy:0,yx:0,yy:-1},{xx:0,xy:1,yx:1,yy:0},{xx:0,xy:1,yx:-1,yy:0},{xx:0,xy:-1,yx:1,yy:0},{xx:0,xy:-1,yx:-1,yy:0}];n(t,e);for(var a=0;a<8;a++)s(1,0,1,r[a])}class u{constructor(t,e,i,n){this.terrain=t,this.cid=e,this.obstacle=i,this.unit=n,this.rfov=new Set,this.xfov=new Set,this.dfov=new Set,this.povs=[],this.peeked=[]}calculatePovAnCover(){this.obstacle||(this.cover=this.terrain.obstacles(this.cid),this.calculatePovs())}calculateFov(){if(this.opaque)return;let t=this.terrain,[e,i]=this.at,n=new Set;d(e,i,(e,i)=>!t.cellAt(e,i).opaque,(e,i)=>{n.add(t.cid(e,i))}),this.rfov=n}calculateXFov(){let t=new Set;for(let e of this.povs)for(let i of e.rfov){let e=this.terrain.cells[i];for(let i of e.peeked)t.add(i.cid)}this.xfov=t}calculateDFov(){let t=new Set;for(let e of this.povs)for(let i of e.rfov)t.add(i);this.dfov=t}get at(){return this.terrain.fromCid(this.cid)}dist(t){return h(this.at,t.at)}seal(){this.obstacle=2,delete this.unit,this.goody=0}get opaque(){return 2==this.obstacle}get passable(){return this.obstacle<2&&!this.hole}get standable(){return 0==this.obstacle&&!this.hole&&!this.unit}calculatePovs(){this.povs=[];let t=this.terrain,e=this.cid;this.povs.push(this);for(let i=0;i<8;i+=2){let n=e+t.dir8Deltas[i];if(!t.cells[n].obstacle)continue;let s=[e+t.dir8Deltas[(i+6)%8],e+t.dir8Deltas[(i+7)%8]],r=[e+t.dir8Deltas[(i+2)%8],e+t.dir8Deltas[(i+1)%8]];for(let e of[s,r]){t.cells[e[0]].standable&&t.cells[e[1]].obstacle<=1&&this.povs.push(t.cells[e[0]])}}for(let t of this.povs)t.peeked.push(this)}}class f{constructor(t){this.damageOptimalRange=[1,20],this.damage=[4,5],this.damagePenaltyPerCell=100,this.accuracyPenaltyMax=20,this.accuracy=60,this.accuracyOptimalRange=[1,1],this.accuracyPenaltyPerCell=1,this.damagePenaltyMax=2,this.breach=0,this.name="Gun",t&&Object.assign(this,t)}damagePenalty(t){let e=0;return t<this.damageOptimalRange[0]&&(e=this.damageOptimalRange[0]-t),t>this.damageOptimalRange[1]&&(e=t-this.damageOptimalRange[1]),Math.min(this.damagePenaltyMax,this.damagePenaltyPerCell*e)}accuracyPenalty(t){let e=0;return t<this.accuracyOptimalRange[0]&&(e=this.accuracyOptimalRange[0]-t),t>this.accuracyOptimalRange[1]&&(e=t-this.accuracyOptimalRange[1]),Math.min(this.accuracyPenaltyMax,this.accuracyPenaltyPerCell*e)}averageDamage(t,e,i){i||(i=e.cell);let n=.5*(this.damage[1]+this.damage[0]);return n-=Math.max(0,e.armor-this.breach),n-=this.damagePenalty(t.dist(i)),Math.max(0,Math.round(10*n)/10)}damageRoll(t,e,i){let n=i()*(this.damage[1]-this.damage[0])+this.damage[0];return n-=Math.max(0,e.armor-this.breach),n-=this.damagePenalty(t.dist(e)),Math.max(0,Math.round(n))}}f.SNIPER=new f({name:"Sniper",damageOptimalRange:[1,30],damagePenaltyPerCell:.1,accuracyOptimalRange:[10,30],accuracyPenaltyPerCell:1,breach:1}),f.SHOTGUN=new f({name:"Shotgun",damage:[6,7],damageOptimalRange:[1,1],damagePenaltyMax:4,damagePenaltyPerCell:.3,accuracy:80,accuracyOptimalRange:[1,1],accuracyPenaltyPerCell:5,accuracyPenaltyMax:40});var p=Object.freeze({sniper:"\nHits accurately and hard at long range, regardless of target's armor.\nHas extra defence, making him nearly untouchable when in cover. \nPretty helpess up close and has low HP.\n",assault:"\nPsycho with a shotgun. \nFast and even has a bit of armor to survive close quater fight a bit longer.\nCan deal a lot of damage, but only up close.\n",gunner:"\nEffective in any range and has extra hp.\nQuite slow.\n"});class m{constructor(t,e){this.terrain=t,this.faction=e,this.fov=new Set}calculate(){this.strength=[],this.weakness=[],this.distance=[];let t=this.terrain;this.fov.clear();for(let t of this.units)for(let e of t.cell.xfov)this.fov.add(e);let e=this.terrain.teams[1-this.faction];for(let i of this.fov){let n=this.terrain.cells[i];for(let s of e.units){let e=s.cell,r=(4-t.cover(n,e))%5;this.strength[i]>r||(this.strength[i]=r);let a=(4-t.cover(e,n))%5;if(this.weakness[i]>a||(this.weakness[i]=a),r>0||a>0){let t=n.dist(e);this.distance[i]<=t||(this.distance[i]=t)}}}}think(){return r(this,void 0,void 0,function*(){this.terrain.aiTurn=!0,this.calculate();for(let t of this.terrain.units)t.team==this&&(yield t.think());this.terrain.aiTurn=!1})}get units(){return this.terrain.units.filter(t=>t.team==this)}get enemy(){return this.terrain.teams[1-this.faction]}get name(){return["RED","BLUE"][this.faction]}get color(){return["RED","BLUE"][this.faction]}}m.RED=0,m.BLUE=1;class v{constructor(t,e,i,n,s=new f){switch(this.terrain=t,this.kind=e,this.team=i,this.cid=n,this.gun=s,this.speed=5,this.maxHP=10,this.hp=this.maxHP,this.ap=2,this.armor=0,this.sight=20,this.def=0,e!=v.EYE&&t.units.push(this),e){case v.GUNNER:this.speed=4,this.hp=14;break;case v.ASSAULT:this.speed=6,this.armor=1,this.gun=f.SHOTGUN;break;case v.SNIPER:this.hp=7,this.def=10,this.gun=f.SNIPER}this.maxHP=this.hp}static from(t,e,i){let n=v.letters.indexOf(e);return n>=0?new v(t,n,t.teams[m.RED],i):(n=v.letters.indexOf(e.toLowerCase()))>=0?new v(t,n,t.teams[m.BLUE],i):void 0}get blue(){return this.team==this.terrain.we}pathTo(t){let e=t.cid,i=[e];for(;!((e=this.dists[e][1])<0);)i.push(e);return i.reverse().map(t=>this.terrain.cells[t])}get strokeColor(){return this.blue?"#00a":"#a00"}get x(){return this.cid%this.terrain.w}get y(){return s(this.cid,this.terrain.w)}get cell(){return this.terrain.cells[this.cid]}reachable(t){return this.apCost(t)<=this.ap}calculateDists(){this.dists=this.terrain.calcDists(this.cid)}calculate(){this.calculateDists()}cover(t){return this.terrain.cover(this.cell,t)}get at(){return this.terrain.fromCid(this.cid)}apCost(t){if(!this.dists)return Number.MAX_VALUE;let e=this.dists[t.cid][0];return Math.ceil(e/this.speed)}canShoot(){return this.ap>0}hitChance(t,e,i=!1){if(!(i?this.cell.dfov:this.cell.xfov).has((e||t.cell).cid))return 0;let n=this.cover(e||t.cell);if(-1==n)return 0;let s=this.gun.accuracy,r=t.def;return Math.round(s-20*n-r-this.gun.accuracyPenalty(this.dist(t)))}die(){this.terrain.units=this.terrain.units.filter(t=>t.hp>0),delete this.cell.unit,0==this.team.units.length&&this.terrain.declareVictory(this.team.enemy)}takeDamage(t){this.hp=Math.max(0,this.hp-t),this.hp<=0&&this.die(),this.onChange()}onChange(){this.terrain.animate({char:this})}shoot(t){return r(this,void 0,void 0,function*(){if(!t)return!1;let e=t.unit;if(!e)return!1;let i=this.hitChance(e);if(0==i)return!1;let n=this.terrain.rni()%100<i;this.ap=0;let s=0;return n&&(s=this.gun.damageRoll(this,e,this.terrain.rnf)),yield this.animateShoot(e.cid,s),e.takeDamage(s),e.hp<=0&&this.team.calculate(),!0})}teleport(t){this.cell.cid!=t.cid&&(delete this.cell.unit,this.cid=t.cid,this.cell.unit=this,this.calculate())}move(t){return r(this,void 0,void 0,function*(){if(t==this.cell||!t)return!1;this.ap-=this.apCost(t);let i=this.pathTo(t),n=this.team.enemy.units,s=[];for(let t of n){if(0==t.ap)continue;let n=e(i,e=>!e.unit&&t.averageDamage(this,e,!0));n&&n.val>=1&&(console.log(n.val),s.push({moment:n.ind,enemy:t}))}s=s.sort((t,e)=>t.moment>e.moment?1:-1);for(let t of s){let e=i[t.moment];if(yield this.animateWalk(this.pathTo(e)),this.teleport(e),yield t.enemy.shoot(e),!this.alive)return!0}return yield this.animateWalk(this.pathTo(t)),this.teleport(t),this.cell.goody&&(this.hp=this.maxHP,this.cell.goody=0),!0})}animateWalk(t){return r(this,void 0,void 0,function*(){t.length<=1||(yield this.terrain.animate({anim:"walk",char:this,path:t}))})}animateShoot(t,e){return r(this,void 0,void 0,function*(){yield this.terrain.animate({anim:"shoot",from:this.cid,to:t,damage:e})})}canDamage(t){return t&&this.team!=t.team&&this.cell.xfov.has(t.cid)&&this.canShoot()}bestPosition(){let t=this.team;this.calculate();let e,i=-100;for(let n in this.dists){let r=this.dists[n][0];if(r>this.speed*this.ap)continue;let a=t.strength[n]-t.weakness[n]-.5*s(r,this.speed)-.001*r;this.kind==v.ASSAULT&&(a-=.1*t.distance[n]),this.kind==v.SNIPER&&(a+=.1*t.distance[n]),a>i&&(i=a,e=Number(n))}return this.terrain.cells[e]}averageDamage(t,e,i=!1){return this.hitChance(t,e,i)*this.gun.averageDamage(this,t,e)/100}bestTarget(){let t=-100,e=null;for(let i of this.terrain.units){if(i.team==this.team||i.hp<=0)continue;let n=this.averageDamage(i);n>t&&(t=n,e=i.cell)}return e}think(){return r(this,void 0,void 0,function*(){yield this.move(this.bestPosition()),this.ap>0&&(yield this.shoot(this.bestTarget()))})}dist(t){return h(this.at,t.at)}info(){let t=[,"gunner","assault","sniper"][this.kind];return`${t.toUpperCase()} <b>${this.hp}HP</b> ${p[t]}`}get alive(){return this.hp>0}friendly(t){return t&&this.team==t.team}}v.EYE=-1,v.GUNNER=1,v.ASSAULT=2,v.SNIPER=3,v.RECON=4,v.MEDIC=5,v.HEAVY=6,v.COMMANDER=7,v.letters="`gasrmhc".split("");class g{constructor(t,e){var i;this.terrainString=t,this.animate=e,this.aiTurn=!1,this.rni=(i=1,(i%=2147483647)<=0&&(i+=2147483646),()=>i=16807*i%2147483647),this.rnf=(()=>this.rni()%1e9/1e9),this.init(t)}init(t){let e=t.split("\n").map(t=>t.trim()).filter(t=>t.length>0);this.h=e.length,this.w=Math.max(...e.map(t=>t.length)),this.cells=[],this.units=[],this.teams=[];for(let t=0;t<2;t++){let e=new m(this,t);this.teams[t]=e}for(let t=0;t<this.h;t++){delete this.victor;let i=e[t];for(let e=0;e<this.w;e++){let n=e+t*this.w,s=i[e]||" ",r=new u(this,n,["+","#"].indexOf(s)+1,v.from(this,s,this.cid(e,t)));"*"==s&&(r.goody=1),"~"==s&&(r.hole=!0),this.cells[n]=r}}for(let t=0;t<this.w;t++)this.seal(t,0),this.seal(t,this.h-1);for(let t=0;t<this.h;t++)this.seal(0,t),this.seal(this.w-1,t);this.dir8Deltas=g.dirs8.map(t=>t[0]+t[1]*this.w);for(let t of this.cells)t.obstacle||t.calculatePovAnCover();for(let t of this.cells)t.obstacle||(t.calculatePovAnCover(),t.calculateFov());for(let t of this.cells)t.obstacle||(t.calculateXFov(),t.calculateDFov())}seal(t,e){this.cells[this.cid(t,e)].seal()}calcDists(t){let e=this.cells.map(t=>[Number.MAX_VALUE,-1]);e[t]=[0,-1];let i=[t],n=this.cells[t].unit;for(;i.length>0;){let t=i.shift(),s=e[t][0],r=this.cells[t];for(let a=0;a<8;a++){let o=a%2,l=this.dir8Deltas[a]+t,h=this.cells[l];if(!h.passable||h.unit&&!h.unit.friendly(n))continue;if(o&&(this.cells[t+this.dir8Deltas[(a+1)%8]].obstacle||this.cells[t+this.dir8Deltas[(a+7)%8]].obstacle))continue;let c=h.obstacle+r.obstacle+(r.unit?1:0)+(h.unit?1:0);if(c>1&&o&&c>0)continue;let d=c+(o?1.414:1);e[l][0]>s+d&&(e[l]=[s+d,t],i.push(l))}}for(let t=0;t<e.length;t++)this.cells[t].standable||(e[t][0]=Number.MAX_VALUE);return e}cid(t,e){return t+e*this.w}cellAt(t,e){return this.cells[this.cid(t,e)]}fromCid(t){return[t%this.w,s(t,this.w)]}calculateFov(t){let[e,i]=this.fromCid(t),n=new Set;return d(e,i,(t,e)=>!this.cellAt(t,e).opaque,(t,e)=>{for(let i of this.cells[this.cid(t,e)].peeked)n.add(i.cid)}),n}calculateDirectFov(t){let[e,i]=this.fromCid(t),n=new Set;return d(e,i,(t,e)=>!this.cellAt(t,e).opaque,(t,e)=>{n.add(this.cid(t,e))}),n}obstacles(t){let e=[];for(let i=0;i<8;i+=2){let n=t+this.dir8Deltas[i];e.push(this.cells[n].obstacle)}return e}cover(t,e){if(!t.xfov.has(e.cid))return-1;let i=2;for(let r of t.povs){let t=0,a=o(e.at,r.at);for(let i=0;i<4;i++){let r=e.cover[i];r<=t||(n=g.dirs8[2*i],s=a,n[0]*s[0]+n[1]*s[1])<-.001&&(t=r)}t<i&&(i=t)}var n,s;return i}declareVictory(t){this.victor=t}get we(){return this.teams[m.BLUE]}}g.dirs8=[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]];const y=24;class b{constructor(t,e,i,n,s=[0,0]){this.text=t,this.color=e,this.lifeTime=i,this.at=n,this.vel=s,this.time=0}update(t){return this.time+=t,this.at=a(this.at,this.vel,t),this.time<this.lifeTime}render(t){t.save(),t.fillStyle=this.color,t.shadowColor="black",t.shadowBlur=1,t.shadowOffsetX=1,t.shadowOffsetY=1,t.font='12pt "Courier"',t.textAlign="center";let e=0,i=0;for(let n of this.text.split("|"))t.fillText(n.trim().substr(0,Math.floor(70*this.time)-i),this.at[0],this.at[1]+e),i+=n.length,e+=20;t.restore()}}class C{constructor(t,e){this.unit=t,this.at=e.cidToScreen(t.cid)}}class w{constructor(t,e){this.game=t,this.canvas=e,this.canvasCacheOutdated=!1,this.anim=[],this.animQueue=[],this.dolls=[],this.dollCache={},this.width=this.canvas.clientWidth,this.height=this.canvas.clientHeight}synch(){this.dolls=this.terrain.units.map(t=>new C(t,this)),this.updateCanvasCache()}get terrain(){return this.game.terrain}update(t){let e=this.anim;this.anim=[],e=e.filter(e=>e.update(t)),this.anim=this.anim.concat(e),this.animQueue.length>0&&!this.animQueue[0].update(t)&&this.animQueue.shift(),0==this.animQueue.length&&this.blockingAnimationEnd&&(this.blockingAnimationEnd(),delete this.blockingAnimationEnd),this.dolls=this.dolls.filter(t=>t.unit.alive)}render(t){t.clearRect(0,0,this.width,this.height);let e=this.terrain;this.canvasCache&&!this.canvasCacheOutdated||this.updateCanvasCache(),t.clearRect(0,0,e.w*y,e.h*y),t.save(),t.drawImage(this.canvasCache,0,0),t.restore();for(let e of this.dolls)this.renderDoll(t,e);for(let e of this.anim)e.render&&e.render(t);return this.animQueue.length>0&&this.animQueue[0].render&&this.animQueue[0].render(t),this.busy||this.renderPath(t,this.game.hoveredCell),this.animQueue.length>0}renderPath(t,e){let i=this.game.chosen;if(!(i&&e&&i.dists&&i.dists[e.cid]&&-1!=i.dists[e.cid][1]))return;if(!i.reachable(e))return;let n=this.cidToCenter(e.cid);t.beginPath(),i.reachable(e)?t.arc(n[0],n[1],y/4,0,2*Math.PI):(t.moveTo(n[0]-y/4,n[1]-y/4),t.lineTo(n[0]+y/4,n[1]+y/4),t.stroke(),t.beginPath(),t.moveTo(n[0]-y/4,n[1]+y/4),t.lineTo(n[0]+y/4,n[1]-y/4)),t.stroke();let s=i.pathTo(e);t.beginPath(),t.moveTo(...this.cidToCenter(s[0].cid));for(let e of s)t.lineTo(...this.cidToCenter(e.cid));t.stroke()}renderThreats(t,e){let i=this.terrain,n=e.cid;i.teams[m.RED].strength&&(t.strokeStyle="#800",t.lineWidth=4==i.teams[m.RED].strength[n]?3:1,t.beginPath(),t.moveTo(3.5,3.5),t.lineTo(3.5,3.5+3*i.teams[m.RED].strength[n]),t.stroke(),t.strokeStyle="#008",t.lineWidth=4==i.teams[m.RED].weakness[n]?3:1,t.beginPath(),t.moveTo(3.5,3.5),t.lineTo(3.5+3*i.teams[m.RED].weakness[n],3.5),t.stroke())}renderCell(t,e){let i=this.cidToScreen(e.cid),n=[,w.lowTile,w.highTile][e.obstacle];var s,r;e.hole&&(n=w.waterTile),n&&t.drawImage(n,i[0],i[1]),e.goody&&(t.translate(...i),t.fillStyle="#080",t.fillRect(.35*y,0,.3*y,y),t.fillRect(0,.35*y,y,.3*y),t.translate(...(s=i,r=-1,[s[0]*r,s[1]*r])))}renderCellUI(t,e){let i=this.cidToScreen(e.cid),n=this.game;if(t.strokeStyle="#000",t.lineWidth=2,n.hoveredCell){let s=n.hoveredCell.xfov.has(e.cid);n.hoveredCell.rfov.has(e.cid)||(t.fillStyle=`rgba(${s?"50,50,0,0.04":"0,0,50,0.1"})`,t.fillRect(i[0],i[1],y,y))}if(n.chosen&&n.chosen.dists&&!this.busy){let s=n.chosen.apCost(e);if(s>0&&s<=n.chosen.ap){let e=[,w.ap1Sprite,w.ap2Sprite][Math.floor(s)];e&&t.drawImage(e,i[0],i[1])}}e.povs&&e.peeked.includes(this.game.hoveredCell)&&(t.strokeStyle="rgba(0,0,0,0.5)",t.lineWidth=.5,t.beginPath(),t.arc(i[0]+y/2,i[1]+y/2,y/4,0,2*Math.PI),t.stroke())}renderDoll(t,e){t.save(),t.translate(...e.at),this.useDollCache(t,e),e.unit==this.game.chosen?this.outline(t,e,Math.sin((new Date).getTime()/100)+1):e.unit==this.game.hoveredChar&&this.outline(t,e,1.5),t.restore()}outline(t,e,i=2){t.save(),t.strokeStyle=e.unit.strokeColor,t.lineWidth=i,t.beginPath(),t.arc(y/2,y/2,.4*y,0,2*Math.PI),t.stroke(),t.restore()}useDollCache(t,e){let i=e.unit,s=["cid","hp","ap","kind","faction"].map(t=>i[t]);s.push(this.dollTint(e));let r=s.join(",");r in this.dollCache||(this.dollCache[r]=n([y,y],t=>this.renderDollBody(t,e,this.dollTint(e)))),t.drawImage(this.dollCache[r],0,0)}dollTint(t){if(this.busy||this.terrain.aiTurn)return 0;let e=t.unit,i=0,n=this.game.hoveredCell;if(n&&n.xfov){i=n.xfov.has(e.cid)||e.team==this.game.lastSelectedFaction?(0==this.terrain.cover(e.cell,n)?1:0)+(0==this.terrain.cover(n,e.cell)?2:0):4}return this.game.hoveredCell||(i=0),i}renderDollBody(t,e,i){let n=e.unit;t.fillStyle=["#fff","#fba","#cfa","#ffa","#ccc"][i],t.strokeStyle=n.strokeColor,t.shadowColor="#444",t.shadowOffsetX=1,t.shadowOffsetY=1,t.shadowBlur=4,t.beginPath(),t.arc(.5*y,.5*y,.4*y,0,2*Math.PI),t.fill(),t.shadowColor="rgba(0,0,0,0)",t.lineWidth=2;for(let e=0;e<n.hp;e++){let i=Math.PI*(1-e/(n.maxHP-1)),r=(s=i,[Math.cos(s),Math.sin(s)]);t.beginPath(),t.moveTo((.5+.4*r[0])*y,(.5+.4*r[1])*y),t.lineTo((.5+.5*r[0])*y,(.5+.5*r[1])*y),t.stroke()}var s;t.lineWidth=1,t.fillStyle=n.strokeColor,t.textAlign="center",t.font=`bold ${y/2}pt Courier`,t.fillText(v.letters[n.kind].toUpperCase(),.5*y,.66*y),t.stroke(),n.ap>0&&(t.fillStyle=e.unit.strokeColor,t.beginPath(),t.moveTo(1,1),t.lineTo(6,1),t.lineTo(1,6),t.closePath(),t.fill(),n.ap>1&&(t.beginPath(),t.moveTo(y-1,1),t.lineTo(y-6,1),t.lineTo(+y-1,6),t.closePath(),t.fill()))}cidToScreen(t){return this.terrain.fromCid(t).map(t=>t*y)}cidToCenter(t){return this.terrain.fromCid(t).map(t=>(t+.5)*y)}cidScreen(t,e){return this.terrain.cid(s(t,y),s(e,y))}cellAtScreen(t,e){return this.terrain.cells[this.cidScreen(t,e)]}get animationSpeed(){return this.terrain.aiTurn,.5}updateCanvasCache(){this.canvasCache||(this.canvasCache=i(this.terrain.w*y,this.terrain.h*y)),this.canvasTerrain||(this.canvasTerrain=i(this.terrain.w*y,this.terrain.h*y));let t=this.canvasTerrain.getContext("2d");t.clearRect(0,0,this.terrain.w*y,this.terrain.h*y);for(let e=0;e<this.terrain.cells.length;e++){let i=this.terrain.cells[e];this.renderCell(t,i)}let e=this.canvasCache.getContext("2d");e.clearRect(0,0,this.terrain.w*y,this.terrain.h*y),e.save(),e.shadowBlur=4,e.shadowOffsetX=1,e.shadowOffsetY=1,e.shadowColor="#444",e.drawImage(this.canvasTerrain,0,0),e.restore();for(let t=0;t<this.terrain.cells.length;t++){let i=this.terrain.cells[t];this.renderCellUI(e,i)}this.canvasCacheOutdated=!1}resetCanvasCache(){this.canvasCacheOutdated=!0}text(t,e){let i=a(t,[0,-10]);this.anim.push(new b(e,"#f00",3,i,[0,-10]))}renderBullet(t,[e,i],n){t.beginPath();let s=function(t,e=1){let i=l(t)||1;return[t[0]/i*e,t[1]/i*e]}(o(i,e),-20),r=c(e,i,n),h=a(r,s);var d=t.createLinearGradient(h[0],h[1],r[0],r[1]);d.addColorStop(0,"rgba(0,0,0,0)"),d.addColorStop(1,"rgba(0,0,0,1)"),t.lineWidth=4,t.strokeStyle=d,t.moveTo(...h),t.lineTo(...r),t.stroke(),t.lineWidth=1,t.strokeStyle="#000"}shoot(t,e,i){let n,s,r,a=[t,e].map(t=>this.terrain.cells[t]);t:for(s of a[0].povs)for(r of a[1].povs)if(s.rfov.has(r.cid)){n=[s,r].map(t=>this.cidToCenter(t.cid));break t}let l=this.dollAt(t),d=this.dollAt(e),u=0;s.cid==t&&r.cid==e&&(u=1),this.animQueue.push({update:s=>{if(u<1||u>2){let i=.6*(u<1?u:3-u);for(let s=0;s<2;s++){[l,d][s].at=c(this.cidToScreen([t,e][s]),o(n[s],[y/2,y/2]),i)}u+=s*this.animationSpeed*10}else u+=s*Math.min(10,1e3/h(...n)*this.animationSpeed);return!(u>3)||(this.text(n[1],i>0?`-${i}`:"MISS"),l.at=this.cidToScreen(l.unit.cid),d.at=this.cidToScreen(d.unit.cid),!1)},render:t=>{u>1&&u<2&&this.renderBullet(t,n,u-1)}})}walk(t,e){let i=e.map(t=>this.cidToScreen(t.cid)),n=0;this.animQueue.push({update:e=>(n+=15*e*this.animationSpeed,i[Math.floor(n)+1]?(t.at=c(i[Math.floor(n)],i[Math.floor(n)+1],n-Math.floor(n)),!0):(t.at=i[i.length-1],!1))})}dollOf(t){return this.dolls.find(e=>e.unit==t)}dollAt(t){return this.dolls.find(e=>e.unit.cid==t)}draw(t){return r(this,void 0,void 0,function*(){switch(t.anim){case"walk":this.walk(this.dollOf(t.char),t.path);break;case"shoot":this.shoot(t.from,t.to,t.damage)}yield this.waitForAnim()})}waitForAnim(){return new Promise(t=>{this.blockingAnimationEnd=(()=>t())})}get busy(){return this.animQueue.length>0}}w.ap1Sprite=n([y,y],t=>{t.strokeStyle="#555",t.strokeRect(4.5,4.5,y-8,y-8)}),w.ap2Sprite=n([y,y],t=>{t.strokeStyle="#bbb",t.strokeRect(4.5,4.5,y-8,y-8)}),w.hiddenSprite=n([y,y],t=>{t.fillStyle="rgba(0,0,0,0.12)",t.fillRect(0,0,y,y)}),w.dashPattern=n([4,4],t=>{for(let e=0;e<4;e++)t.fillRect(e,e,1,1)}),w.wavePattern=n([12,12],t=>{t.beginPath(),t.arc(6.5,4,7,7,Math.PI),t.stroke()}),w.crossPattern=n([3,3],t=>{for(let e=0;e<4;e++)t.fillRect(4-e-1,e,1,1),t.fillRect(e,e,1,1)}),w.highTile=n([y,y],t=>{t.fillStyle="#000",t.fillRect(0,0,y,y)}),w.lowTile=n([y,y],t=>{t.fillStyle="#fff",t.fillRect(0,0,y,y),t.fillStyle=t.createPattern(w.dashPattern,"repeat"),t.fillRect(0,0,y,y)}),w.waterTile=n([y,y],t=>{t.fillStyle=t.createPattern(w.wavePattern,"repeat"),t.fillRect(0,0,y,y)});class x{constructor(t,e,i){this.canvas=t,this.updateUI=e,this.time=0,this.mode=x.PAI,this.ctx=t.getContext("2d"),this.ctx.imageSmoothingEnabled=!1,this.tooltip=document.getElementById("tooltip"),this.info=document.getElementById("info"),this.canvas.height=this.canvas.clientHeight,this.canvas.width=this.canvas.clientWidth,this.renderer=new w(this,this.canvas),this.init(i)}init(t){t||(t="\n      ##################################################\n      ################# g+         ###++    ##      ++##\n      ################# ++         +                 +##\n      ####################               a+          +##\n      #################                   +    +      ##\n      #################* #          ++++      ##      ##\n      ####################                     +      ##\n      #################        +# + #+a##     g#   ++g##\n      ##################+##  ####################  +####\n      ###   +++  #*+  # g#   a###################      #\n      ###       a#   +# +#    ##########+#++++  #   # *#\n      #   +      ###  #  #    #        # a+++   #   ####\n      #  g+        #  #+ #       +  +  #              ##\n      #   +        ## ## #      g+  +     +           ##\n      #                  #  g #        #+  +++  #     ##\n      #    + ## ####  #     ++#  +  +  #a  +#+  #     ##\n      #    + g# +###  ####    #######  ##########     ##\n      #++  + ## ##a+  +  #   +##+a+     + #  +  ##+   ##\n      #       # +#       #++ +# + +   +g+ # ++ +#+    ##\n      #       # +#   +   #+         +++               ##\n      #   #++## +## #+# ##            +               ##\n      #   +         +         #         ++      #     ##\n      #                  #    # ####### ### ## ### +  ##\n      #   #  a+          #g   # a*##++a     #+  #  +  ##\n      #~~~~~~~~~ ~~~~~~####  ##################### +  ##\n      #~~~~~~~~# #~~~~~~##    a+#+ +                  ##\n      #~~~~~~~~ *              +     # ##          AGA##\n      ###~~~~~~# #~~~~~~~~           #  #          GGA##\n      ####~~~~~~~~~~~~~~~#           # *#          AAA##\n      ##################################################\n      "),this.terrain=new g(t,t=>this.renderer.draw(t)),this.renderer.synch()}over(){return!1}update(t){this.lastLoopTimeStamp||(this.lastLoopTimeStamp=t-.001);let e=Math.min(.02,(t-this.lastLoopTimeStamp)/1e3);this.lastLoopTimeStamp=t,this.time+=e,this.renderer.update(e),this.renderer.render(this.ctx),this.over()&&this.updateUI(),this.chosen&&!this.chosen.alive&&delete this.chosen}updateTooltip(t,e){this.tooltip.style.display=t?"block":"none",t&&(this.tooltip.style.left=(t[0]+30+this.canvas.offsetLeft).toString(),this.tooltip.style.top=t[1].toString(),this.tooltip.innerHTML=e)}updateInfo(t){this.info.innerHTML=t||(this.terrain.victor?`<H3 style="color:white; background:${this.terrain.victor.color}">${this.terrain.victor.name} side victorious</H3>`:"")}click(t,e){let i=this.renderer.cellAtScreen(t,e);this.clickCell(i),this.renderer.resetCanvasCache()}canPlayAs(t){return t.blue||this.mode!=x.PAI}clickCell(t){if(t){if(t.unit){if(this.chosen&&this.chosen.team==t.unit.team&&this.canPlayAs(t.unit))return this.chosen=t.unit,void this.chosen.calculate();if(this.chosen&&this.chosen.canDamage(t.unit))return void this.chosen.shoot(t);this.chosen==t.unit?this.cancel():this.canPlayAs(t.unit)&&(this.chosen=t.unit),this.chosen&&this.chosen.calculate()}!t.unit&&this.chosen&&this.chosen.reachable(t)&&(this.chosen.move(t),this.terrain.teams[m.RED].calculate()),this.lastSelectedFaction=this.chosen?this.chosen.team:this.terrain.we}}cancel(){delete this.chosen,this.renderer.resetCanvasCache()}hover(t,e){let i=this.renderer.cellAtScreen(t,e);if(this.hoveredCell==i)return;if(!i)return delete this.hoveredCell,void this.renderer.resetCanvasCache();if(!i)return;this.hoveredCell=i;let n="default";(this.chosen&&this.chosen.reachable(i)||i.unit)&&(n="pointer"),this.chosen&&this.chosen.canDamage(i.unit)?(n="crosshair",this.updateTooltip(this.renderer.cidToCenter(i.cid),`${this.chosen.hitChance(i.unit)}% ${this.chosen.gun.averageDamage(this.chosen,i.unit).toFixed(1)}`)):this.updateTooltip(),document.body.style.cursor=n,i.unit?this.updateInfo(i.unit.info()):this.updateInfo(),this.renderer.busy||this.renderer.resetCanvasCache()}endTurn(){return r(this,void 0,void 0,function*(){delete this.chosen,this.mode==x.AIAI&&(yield this.terrain.teams[m.BLUE].think()),this.mode!=x.PP&&(yield this.terrain.teams[m.RED].think());for(let t of this.terrain.units)t.ap=2;this.renderer.resetCanvasCache()})}toggleMode(){return this.mode=(this.mode+1)%3,["[P+AI] 2P 2AI","P+AI [2P] 2AI","P+AI 2P [2AI]"][this.mode]}setMode(t){this.mode=t}get hoveredChar(){if(this.hoveredCell)return this.hoveredCell.unit}}x.PAI=0,x.PP=1,x.AIAI=2;var P=function(){},S={},k=[],T=[];function _(t,e){var i,n,s,r,a=T;for(r=arguments.length;r-- >2;)k.push(arguments[r]);for(e&&null!=e.children&&(k.length||k.push(e.children),delete e.children);k.length;)if((n=k.pop())&&void 0!==n.pop)for(r=n.length;r--;)k.push(n[r]);else"boolean"==typeof n&&(n=null),(s="function"!=typeof t)&&(null==n?n="":"number"==typeof n?n=String(n):"string"!=typeof n&&(s=!1)),s&&i?a[a.length-1]+=n:a===T?a=[n]:a.push(n),i=s;var o=new P;return o.nodeName=t,o.children=a,o.attributes=null==e?void 0:e,o.key=null==e?void 0:e.key,o}function A(t,e){for(var i in e)t[i]=e[i];return t}function E(t,e){t&&("function"==typeof t?t(e):t.current=e)}var M="function"==typeof Promise?Promise.resolve().then.bind(Promise.resolve()):setTimeout,D=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,R=[];function I(t){!t._dirty&&(t._dirty=!0)&&1==R.push(t)&&M(N)}function N(){for(var t;t=R.pop();)t._dirty&&Z(t)}function L(t,e){return t.normalizedNodeName===e||t.nodeName.toLowerCase()===e.toLowerCase()}function O(t){var e=A({},t.attributes);e.children=t.children;var i=t.nodeName.defaultProps;if(void 0!==i)for(var n in i)void 0===e[n]&&(e[n]=i[n]);return e}function U(t){var e=t.parentNode;e&&e.removeChild(t)}function B(t,e,i,n,s){if("className"===e&&(e="class"),"key"===e);else if("ref"===e)E(i,null),E(n,t);else if("class"!==e||s)if("style"===e){if(n&&"string"!=typeof n&&"string"!=typeof i||(t.style.cssText=n||""),n&&"object"==typeof n){if("string"!=typeof i)for(var r in i)r in n||(t.style[r]="");for(var r in n)t.style[r]="number"==typeof n[r]&&!1===D.test(r)?n[r]+"px":n[r]}}else if("dangerouslySetInnerHTML"===e)n&&(t.innerHTML=n.__html||"");else if("o"==e[0]&&"n"==e[1]){var a=e!==(e=e.replace(/Capture$/,""));e=e.toLowerCase().substring(2),n?i||t.addEventListener(e,H,a):t.removeEventListener(e,H,a),(t._listeners||(t._listeners={}))[e]=n}else if("list"!==e&&"type"!==e&&!s&&e in t){try{t[e]=null==n?"":n}catch(t){}null!=n&&!1!==n||"spellcheck"==e||t.removeAttribute(e)}else{var o=s&&e!==(e=e.replace(/^xlink:?/,""));null==n||!1===n?o?t.removeAttributeNS("http://www.w3.org/1999/xlink",e.toLowerCase()):t.removeAttribute(e):"function"!=typeof n&&(o?t.setAttributeNS("http://www.w3.org/1999/xlink",e.toLowerCase(),n):t.setAttribute(e,n))}else t.className=n||""}function H(t){return this._listeners[t.type](t)}var W=[],F=0,Q=!1,V=!1;function $(){for(var t;t=W.shift();)t.componentDidMount&&t.componentDidMount()}function X(t,e,i,n,s,r){F++||(Q=null!=s&&void 0!==s.ownerSVGElement,V=null!=t&&!("__preactattr_"in t));var a=G(t,e,i,n,r);return s&&a.parentNode!==s&&s.appendChild(a),--F||(V=!1,r||$()),a}function G(t,e,i,n,s){var r=t,a=Q;if(null!=e&&"boolean"!=typeof e||(e=""),"string"==typeof e||"number"==typeof e)return t&&void 0!==t.splitText&&t.parentNode&&(!t._component||s)?t.nodeValue!=e&&(t.nodeValue=e):(r=document.createTextNode(e),t&&(t.parentNode&&t.parentNode.replaceChild(r,t),q(t,!0))),r.__preactattr_=!0,r;var o,l,h=e.nodeName;if("function"==typeof h)return function(t,e,i,n){var s=t&&t._component,r=s,a=t,o=s&&t._componentConstructor===e.nodeName,l=o,h=O(e);for(;s&&!l&&(s=s._parentComponent);)l=s.constructor===e.nodeName;s&&l&&(!n||s._component)?(K(s,h,3,i,n),t=s.base):(r&&!o&&(tt(r),t=a=null),s=z(e.nodeName,h,i),t&&!s.nextBase&&(s.nextBase=t,a=null),K(s,h,1,i,n),t=s.base,a&&t!==a&&(a._component=null,q(a,!1)));return t}(t,e,i,n);if(Q="svg"===h||"foreignObject"!==h&&Q,h=String(h),(!t||!L(t,h))&&(o=h,(l=Q?document.createElementNS("http://www.w3.org/2000/svg",o):document.createElement(o)).normalizedNodeName=o,r=l,t)){for(;t.firstChild;)r.appendChild(t.firstChild);t.parentNode&&t.parentNode.replaceChild(r,t),q(t,!0)}var c=r.firstChild,d=r.__preactattr_,u=e.children;if(null==d){d=r.__preactattr_={};for(var f=r.attributes,p=f.length;p--;)d[f[p].name]=f[p].value}return!V&&u&&1===u.length&&"string"==typeof u[0]&&null!=c&&void 0!==c.splitText&&null==c.nextSibling?c.nodeValue!=u[0]&&(c.nodeValue=u[0]):(u&&u.length||null!=c)&&function(t,e,i,n,s){var r,a,o,l,h,c=t.childNodes,d=[],u={},f=0,p=0,m=c.length,v=0,g=e?e.length:0;if(0!==m)for(var y=0;y<m;y++){var b=c[y],C=b.__preactattr_,w=g&&C?b._component?b._component.__key:C.key:null;null!=w?(f++,u[w]=b):(C||(void 0!==b.splitText?!s||b.nodeValue.trim():s))&&(d[v++]=b)}if(0!==g)for(var y=0;y<g;y++){l=e[y],h=null;var w=l.key;if(null!=w)f&&void 0!==u[w]&&(h=u[w],u[w]=void 0,f--);else if(p<v)for(r=p;r<v;r++)if(void 0!==d[r]&&(x=a=d[r],S=s,"string"==typeof(P=l)||"number"==typeof P?void 0!==x.splitText:"string"==typeof P.nodeName?!x._componentConstructor&&L(x,P.nodeName):S||x._componentConstructor===P.nodeName)){h=a,d[r]=void 0,r===v-1&&v--,r===p&&p++;break}h=G(h,l,i,n),o=c[y],h&&h!==t&&h!==o&&(null==o?t.appendChild(h):h===o.nextSibling?U(o):t.insertBefore(h,o))}var x,P,S;if(f)for(var y in u)void 0!==u[y]&&q(u[y],!1);for(;p<=v;)void 0!==(h=d[v--])&&q(h,!1)}(r,u,i,n,V||null!=d.dangerouslySetInnerHTML),function(t,e,i){var n;for(n in i)e&&null!=e[n]||null==i[n]||B(t,n,i[n],i[n]=void 0,Q);for(n in e)"children"===n||"innerHTML"===n||n in i&&e[n]===("value"===n||"checked"===n?t[n]:i[n])||B(t,n,i[n],i[n]=e[n],Q)}(r,e.attributes,d),Q=a,r}function q(t,e){var i=t._component;i?tt(i):(null!=t.__preactattr_&&E(t.__preactattr_.ref,null),!1!==e&&null!=t.__preactattr_||U(t),Y(t))}function Y(t){for(t=t.lastChild;t;){var e=t.previousSibling;q(t,!0),t=e}}var j=[];function z(t,e,i){var n,s=j.length;for(t.prototype&&t.prototype.render?(n=new t(e,i),et.call(n,e,i)):((n=new et(e,i)).constructor=t,n.render=J);s--;)if(j[s].constructor===t)return n.nextBase=j[s].nextBase,j.splice(s,1),n;return n}function J(t,e,i){return this.constructor(t,i)}function K(t,e,i,n,s){t._disable||(t._disable=!0,t.__ref=e.ref,t.__key=e.key,delete e.ref,delete e.key,void 0===t.constructor.getDerivedStateFromProps&&(!t.base||s?t.componentWillMount&&t.componentWillMount():t.componentWillReceiveProps&&t.componentWillReceiveProps(e,n)),n&&n!==t.context&&(t.prevContext||(t.prevContext=t.context),t.context=n),t.prevProps||(t.prevProps=t.props),t.props=e,t._disable=!1,0!==i&&(1!==i&&!1===S.syncComponentUpdates&&t.base?I(t):Z(t,1,s)),E(t.__ref,t))}function Z(t,e,i,n){if(!t._disable){var s,r,a,o=t.props,l=t.state,h=t.context,c=t.prevProps||o,d=t.prevState||l,u=t.prevContext||h,f=t.base,p=t.nextBase,m=f||p,v=t._component,g=!1,y=u;if(t.constructor.getDerivedStateFromProps&&(l=A(A({},l),t.constructor.getDerivedStateFromProps(o,l)),t.state=l),f&&(t.props=c,t.state=d,t.context=u,2!==e&&t.shouldComponentUpdate&&!1===t.shouldComponentUpdate(o,l,h)?g=!0:t.componentWillUpdate&&t.componentWillUpdate(o,l,h),t.props=o,t.state=l,t.context=h),t.prevProps=t.prevState=t.prevContext=t.nextBase=null,t._dirty=!1,!g){s=t.render(o,l,h),t.getChildContext&&(h=A(A({},h),t.getChildContext())),f&&t.getSnapshotBeforeUpdate&&(y=t.getSnapshotBeforeUpdate(c,d));var b,C,w=s&&s.nodeName;if("function"==typeof w){var x=O(s);(r=v)&&r.constructor===w&&x.key==r.__key?K(r,x,1,h,!1):(b=r,t._component=r=z(w,x,h),r.nextBase=r.nextBase||p,r._parentComponent=t,K(r,x,0,h,!1),Z(r,1,i,!0)),C=r.base}else a=m,(b=v)&&(a=t._component=null),(m||1===e)&&(a&&(a._component=null),C=X(a,s,h,i||!f,m&&m.parentNode,!0));if(m&&C!==m&&r!==v){var P=m.parentNode;P&&C!==P&&(P.replaceChild(C,m),b||(m._component=null,q(m,!1)))}if(b&&tt(b),t.base=C,C&&!n){for(var S=t,k=t;k=k._parentComponent;)(S=k).base=C;C._component=S,C._componentConstructor=S.constructor}}for(!f||i?W.push(t):g||t.componentDidUpdate&&t.componentDidUpdate(c,d,y);t._renderCallbacks.length;)t._renderCallbacks.pop().call(t);F||n||$()}}function tt(t){var e=t.base;t._disable=!0,t.componentWillUnmount&&t.componentWillUnmount(),t.base=null;var i=t._component;i?tt(i):e&&(null!=e.__preactattr_&&E(e.__preactattr_.ref,null),t.nextBase=e,U(e),j.push(t),Y(e)),E(t.__ref,null)}function et(t,e){this._dirty=!0,this.context=e,this.props=t,this.state=this.state||{},this._renderCallbacks=[]}let it,nt;A(et.prototype,{setState:function(t,e){this.prevState||(this.prevState=this.state),this.state=A(A({},this.state),"function"==typeof t?t(this.state,this.props):t),e&&this._renderCallbacks.push(e),I(this)},forceUpdate:function(t){t&&this._renderCallbacks.push(t),Z(this,2)},render:function(){}});let st,rt,at,ot,lt,ht=0,ct=0;function dt(t){(nt=t)||it.getContext("2d").clearRect(0,0,1200,1200)}function ut(){dt(nt)}function ft(){for(let t=0;t<3;t++)t==ct?rt[t].classList.add("pressed"):rt[t].classList.remove("pressed");for(let t=0;t<3;t++)t==ht?(st[t].classList.add("pressed"),at[t].style.display="block"):(st[t].classList.remove("pressed"),at[t].style.display="none");lt.innerHTML=0==ht?"End Turn":"Apply",lt.style.visibility=1==ht?"hidden":"visible"}function pt(t){return _("div",{class:"bottom row"},[["pai","vs AI"],["pp","2P"],["aiai","2AI"]].map(([t,e])=>_("button",{class:"small",id:t},e))," ",[["playb","Play"],["helpb","Help"],["editb","Edit"]].map(([t,e])=>_("button",{class:"small",id:t},e)),_("div",{id:"info"}),_("button",{id:"endb"},"End Turn"))}return window.onload=function(){it=document.getElementById("main");let t=document.getElementById("buttons");var e,i;e=_(pt,null),X(i,e,{},!1,t,!1),lt=document.getElementById("endb"),at=["main","help","editor"].map(t=>document.getElementById(t)),st=["playb","helpb","editb"].map(t=>document.getElementById(t));for(let t=0;t<3;t++)st[t].onclick=(e=>{ht=t,ft()});rt=["pai","pp","aiai"].map(t=>document.getElementById(t));for(let t=0;t<3;t++)rt[t].onclick=(e=>{ct=t,nt.setMode(ct),ft()});ft(),dt(new x(it,ut)),lt.onclick=(t=>{0==ht&&nt.endTurn(),2==ht&&(nt.init(ot.value),ht=0,ft())}),ot=document.getElementById("edit-area"),it.addEventListener("mousedown",t=>{2==t.button?(console.log(nt.terrain),nt.cancel()):nt.click(t.offsetX,t.offsetY)}),it.addEventListener("mousemove",t=>{nt.hover(t.offsetX,t.offsetY)}),it.addEventListener("mouseleave",t=>{nt.hover(void 0,void 0)}),it.addEventListener("mouseenter",t=>{}),it.addEventListener("contextmenu",function(t){t.preventDefault()},!1),document.addEventListener("keyup",t=>{}),document.addEventListener("keydown",t=>{}),function t(e){requestAnimationFrame(i=>{e(i),t(e)})}(t=>{nt&&!nt.over()&&nt.update(t),0==ht&&(lt.style.visibility=nt.renderer.busy?"hidden":"visible")}),dt(nt),console.log(nt.terrain.terrainString),ot.value=nt.terrain.terrainString},t.mouseAt=void 0,t}({});
